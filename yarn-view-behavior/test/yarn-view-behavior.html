<html>
  <head>

    <title>yarn-view-behavior tests</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">

    <script src="../../../webcomponentsjs/webcomponents-lite.js"></script>

    <script src="../../../web-component-tester/browser.js"></script>
    <script src="../../../test-fixture/test-fixture-mocha.js"></script>

    <link rel="import" href="../../../test-fixture/test-fixture.html">
    <link rel="import" href="test-view.html">

  </head>
  <body>

    <test-fixture id="no-options">
      <template>
        <test-view></test-view>
      </template>
    </test-fixture>

    <script>
      suite('<yarn-view-behavior>', function() {

        suite('without options', function() {

          var view;

          setup(function() {

            view = fixture('no-options');
          });

          test('waits for `viewIsReady` to call `_enter`.', function(done) {

            assert.equal(view.activeView, false);
            assert.equal(view.viewReady, false);
            assert.equal(view.viewLoading, false);

            var fired = [];

            var logEvent = function(e) {

              fired.push(e.type);
            }

            view.addEventListener('yarn-view-waiting', logEvent);
            view.addEventListener('yarn-view-ready', logEvent);
            view.addEventListener('yarn-view-active', logEvent);

            view.makeView();

            assert.equal(fired.length, 1);
            assert.equal(fired[0], 'yarn-view-waiting');

            requestAnimationFrame(function() {

              view.viewIsReady();

              assert.equal(fired.length, 3);
              assert.equal(fired[1], 'yarn-view-ready');
              assert.equal(fired[2], 'yarn-view-active');

              assert.equal(view.hasBeenEntered, false);

              view.async(function() {

                assert.equal(view.hasBeenEntered, true);

                done();
              });

            });

          });

        });

      });

    </script>

  </body>
</html>
